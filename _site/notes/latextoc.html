<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>LaTeX Custom ToC</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@_cmry" /><meta name="twitter:title" content="LaTeX Custom ToC" /><meta name="twitter:description" content="Over the last few weeks, I have been working on a python script that can convert an XML file generated by EasyChair to a Book of Abstracts used at conferences. One of the problems I faced was that ..."><meta name="description" content="Over the last few weeks, I have been working on a python script that can convert an XML file generated by EasyChair to a Book of Abstracts used at conference..."><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/touch-icon.png"> <script type="text/x-mathjax-config"> MathJax.Hub.Config({tex2jax: {inlineMath: [["$","$"], ['\\(','\\)']]}});</script> <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="canonical" href="/notes/latextoc"><link rel="alternate" type="application/atom+xml" title="Chris Emmery" href="/feed.xml" /></head><body><aside class="logo"><nav> <a href="https://cmry.github.io"><i class="fa fa-home"></i></a> · <a href="https://www.github.com/cmry"><i class="fa fa-github"></i></a> · <a href="https://www.twitter.com/_cmry"><i class="fa fa-twitter"></i></a> · <a id="ind-publ" href="/publications">publ</a> · <a id="ind-code" href="/code">code</a> · <a id="ind-work" href="/work">work</a> · <a id="ind-about" href="/about">about</a></nav></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>LaTeX Custom ToC</h1><time>January 14, 2015</time></div><div class="divider"></div><p>Over the last few weeks, I have been working on a <code class="highlighter-rouge">python</code> script that can convert an <code class="highlighter-rouge">XML</code> file generated by <a href="http://easychair.org/">EasyChair</a> to a Book of Abstracts used at conferences. One of the problems I faced was that I had to create a custom Table of Contents with the title of the submitted abstracts and their page number, and its authors below.</p><div class="highlighter-rouge"><pre class="highlight"><code>1 Abstracts
   This is an abstract ................... 1
   Author 1, Author 2, Author 3
</code></pre></div><p>Luckily, <code class="highlighter-rouge">LaTeX</code> allows for adding custom entries to the table of contents. So there is no need to mess around with adding the abstracts as real sections, and messing up the lay-out to keep them in a correct format. This is commonly done with <code class="highlighter-rouge">\addcontentstoline{toc}{section}{title}</code>. In-text example:</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="k">\chapter</span><span class="p">{</span>Abstracts<span class="p">}</span>
<span class="k">\newpage</span>

<span class="k">\addcontentstoline</span><span class="p">{</span>toc<span class="p">}{</span>section<span class="p">}{</span>This is an abstract<span class="p">}</span>

<span class="k">\center</span><span class="p">{</span>
  <span class="k">\large</span><span class="p">{</span><span class="k">\textbf</span><span class="p">{</span>This is an abstract<span class="p">}}</span>
  Author 1, Author 2, Author 3
<span class="p">}</span>
</code></pre></div><p>After which we should see the following: <code class="highlighter-rouge">text This is an abstract ................... 1 </code></p><p>Now comes the tricky part, though, as adding the authors to the section title is obviously not something we would want. We cannot use the <code class="highlighter-rouge">\addcontentstoline</code> either, as that would result in the following:</p><div class="highlighter-rouge"><pre class="highlight"><code>This is an abstract ................... 1
Author 1, Author 2, Author 3 .......... 1
</code></pre></div><p>Yeah, not really aesthetically pleasing. We do not specifically have to add to a section though, as <code class="highlighter-rouge">\addcontents{toc}{text}</code> can be used to add the list of authors. Adding some spacing here and there would look something like:</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="c">%...</span>

<span class="k">\addcontentstoline</span><span class="p">{</span>toc<span class="p">}{</span>section<span class="p">}{</span>This is an abstract<span class="p">}</span>
<span class="k">\addcontents</span><span class="p">{</span>toc<span class="p">}{</span><span class="k">\protect\vspace</span><span class="p">{</span>0.2em<span class="p">}}</span>
<span class="k">\addcontents</span><span class="p">{</span>toc<span class="p">}{</span>Author 1, Author 2, Author 3<span class="p">}</span>

<span class="k">\center</span><span class="p">{</span>
  <span class="k">\large</span><span class="p">{</span><span class="k">\textbf</span><span class="p">{</span>This is an abstract<span class="p">}}</span>
  Author 1, Author 2, Author 3
<span class="p">}</span>
</code></pre></div><p>This works, and looks pretty good already. There’s two assumptions we are making with this, though. We assume that the title does not continue on a second line, and the same goes for the list of authors. Well, surprise! In reality papers can have a department worth of authors and titles that try to capture exactly what’s in the abstract. We would hope that <code class="highlighter-rouge">LaTeX</code> handles this in automation, but no, unfortunately it does not. Instead, it spews out this masterpiece of indentation:</p><div class="highlighter-rouge"><pre class="highlight"><code>    This is an abstract with a very long title
        and continues here ..................... 1
    Author 1, Author 2, Author 3, Author 4, Author
5, Author 6, Author 7
</code></pre></div><p>Great, so the indentation of the title on the second line is acceptable, but in combination with the unindented author list, everyone is bound to weep at the sight of the abomination that is your Table of Contents. I decided to level everything to the same indentation. The approach to tackle this can be different, and probably a bit neater, but I came up with this: in the preamble we change the indentation of the sections that form our titles, as such:</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="c">% ...</span>

<span class="k">\setlength</span><span class="p">{</span><span class="k">\cftsecnumwidth</span><span class="p">}{</span>0pt<span class="p">}</span>
<span class="k">\renewcommand</span><span class="p">{</span><span class="k">\cftsecaftersnumb</span><span class="p">}{</span><span class="k">\hspace</span><span class="p">{</span>1.5em<span class="p">}}</span>

<span class="c">%...</span>
</code></pre></div><p>I guess it would be possible to do the same had we included our author list in a subsection, but for now I just went with an <code class="highlighter-rouge">\hspace*</code> for the author line, like so:</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="c">%...</span>

<span class="k">\addcontentstoline</span><span class="p">{</span>toc<span class="p">}{</span>section<span class="p">}{</span>This is an abstract<span class="p">}</span>
<span class="k">\addcontents</span><span class="p">{</span>toc<span class="p">}{</span><span class="k">\protect\vspace</span><span class="p">{</span>0.2em<span class="p">}}</span>
<span class="k">\addtocontents</span><span class="p">{</span>toc<span class="p">}{</span>Authors part I <span class="k">\newline</span><span class="p">}</span>
<span class="k">\addtocontents</span><span class="p">{</span>toc<span class="p">}{</span><span class="k">\hspace*</span><span class="p">{</span>1.2em<span class="p">}</span> Authors part II<span class="p">}</span>
<span class="k">\addtocontents</span><span class="p">{</span>toc<span class="p">}{</span><span class="k">\protect\vspace</span><span class="p">{</span>1em<span class="p">}}</span>

<span class="k">\center</span><span class="p">{</span>
  <span class="k">\large</span><span class="p">{</span><span class="k">\textbf</span><span class="p">{</span>This is an abstract<span class="p">}}</span>
  Author 1, Author 2, Author 3
<span class="p">}</span>
</code></pre></div><p>With this approach I had to split the list of author names with <code class="highlighter-rouge">python</code> once it became too long, making sure that the second part of the list was placed on a newline. As I was scripting the whole thing anyway, this was not really a problem. The code could for example be:</p><div class="highlighter-rouge"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">format_toc</span><span class="p">(</span><span class="n">titl</span><span class="p">,</span> <span class="n">name_l</span><span class="p">):</span>
    <span class="s">"""
    Accepts title and authors of the abstract, and will
    convert these into a formatted unicode LaTeX toc entry.
    :param titl: str unicode abstract title (no linebreaks)
    :param name_l: list str with authors
    :return: str unicode ToC entry for the abstract
    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
    	<span class="n">name_l</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">'</span><span class="se">\\</span><span class="s">newline'</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
   	<span class="n">parts</span> <span class="o">=</span> <span class="p">(</span><span class="s">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name_l</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\\</span><span class="s">newline'</span><span class="p">)</span>
   	<span class="n">newl</span> <span class="o">=</span> <span class="s">"</span><span class="se">\\</span><span class="s">newline"</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">''</span>
   	<span class="n">extl</span> <span class="o">=</span> <span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">addtocontents{toc}{</span><span class="se">\\</span><span class="s">hspace*{1.2em}"</span> <span class="o">+</span> \
   	       <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">"}"</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">''</span>
   	<span class="n">toc</span> <span class="o">=</span> <span class="s">'''
   			</span><span class="se">\\</span><span class="s">addcontentsline{toc}{section}{</span><span class="se">\\</span><span class="s">emph{"</span><span class="si">%</span><span class="s">s"}}
   			</span><span class="se">\\</span><span class="s">addtocontents{toc}{</span><span class="se">\\</span><span class="s">protect</span><span class="se">\\</span><span class="s">vspace{0.2em}}
   			</span><span class="se">\\</span><span class="s">addtocontents{toc}{ </span><span class="si">%</span><span class="s">s </span><span class="se">\\</span><span class="s">hfill </span><span class="si">%</span><span class="s">s }
   			</span><span class="se">\\</span><span class="s">addtocontents{toc}{</span><span class="se">\\</span><span class="s">hspace*{1.2em}" </span><span class="si">%</span><span class="s">s "}
   			</span><span class="si">%</span><span class="s">s
   			</span><span class="se">\\</span><span class="s">addtocontents{toc}{</span><span class="se">\\</span><span class="s">protect</span><span class="se">\\</span><span class="s">vspace{1em}}
 		'''</span> <span class="o">%</span> <span class="p">(</span><span class="n">titl</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">newl</span><span class="p">,</span> <span class="n">extl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">titl</span>

</code></pre></div><blockquote><p><strong>Note:</strong> I have edited the function a bit to a more final and ‘neater’ version in this post, as opposed to the <em>much</em> crappier version on github. It’s the result that counts, for now at least.</p></blockquote></article><div class="back"> <a href="/"></a></div></main></body></html>